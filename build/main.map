{"version":3,"sources":["webpack:///webpack/bootstrap 1e6b9a8fbcab0f2ae62a","webpack:///external \"express\"","webpack:///./server/index.js","webpack:///external \"compression\"","webpack:///external \"express-session\"","webpack:///external \"connect-redis\"","webpack:///external \"nuxt\"","webpack:///./server/api-router.js","webpack:///external \"axios\"","webpack:///external \"http-proxy-middleware\"","webpack:///external \"body-parser\"","webpack:///external \"qs\"","webpack:///./server/config.js","webpack:///./nuxt.config.js"],"names":["app","express","port","process","env","PORT","RedisStore","connectRedis","use","compression","session","store","host","pass","secret","resave","saveUninitialized","cookie","maxAge","config","require","dev","nuxt","builder","build","get","req","res","redirect","render","listen","console","log","router","Router","jsonParser","bodyParser","json","urlencodedParser","urlencoded","extended","axiosInstance","axios","create","headers","checkLogin","next","userData","error_code","info","post","body","userName","password","qs","stringify","then","data","catch","err","message","token","proxy","target","changeOrigin","pathRewrite","APIURL","module","exports","head","title","meta","charset","name","content","hid","link","rel","type","href","script","src","css","lang","plugins","ssr","vendor"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 1e6b9a8fbcab0f2ae62a","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 0\n// module chunks = 0","import express from 'express'\r\nimport compression from 'compression'\r\nimport session from 'express-session'\r\nimport connectRedis from 'connect-redis'\r\nimport { Nuxt, Builder } from 'nuxt'\r\n\r\nimport apiRouter from './api-router'\r\n\r\nconst app = express()\r\nconst port = process.env.PORT || 5000\r\nconst RedisStore = connectRedis(session)\r\n\r\napp.use(compression())\r\napp.use(session({\r\n  store: new RedisStore({\r\n    host: '47.104.27.50',\r\n    port: 3678,\r\n    pass: 'Redis!321.'\r\n  }),\r\n  secret: 'hello world 2018',\r\n  resave:true,\r\n  saveUninitialized: false,\r\n  cookie: { maxAge: 1000 * 60 * 60 * 24 * 7 }\r\n}))\r\n\r\napp.use('/api', apiRouter)\r\n\r\nlet config = require('../nuxt.config')\r\nconfig.dev = !(process.env.NODE_ENV === 'production')\r\nconst nuxt = new Nuxt(config)\r\nif (config.dev) {\r\n  const builder = new Builder(nuxt)\r\n  builder.build()\r\n}\r\n\r\napp.get('/entry', (req, res) => {\r\n  res.redirect('/entry/login')\r\n})\r\napp.get('/', (req, res) => {\r\n  res.redirect('/index/5')\r\n})\r\napp.get('/index', (req, res) => {\r\n  res.redirect('/index/5')\r\n})\r\n\r\napp.use(nuxt.render)\r\n\r\napp.listen(port)\r\nconsole.log('Server listening on ' + ':' + port)\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"compression\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"compression\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"connect-redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect-redis\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 5\n// module chunks = 0","/**\r\n * API路由处理\r\n */\r\n\r\nimport express from 'express'\r\nimport axios from 'axios'\r\nimport proxy from 'http-proxy-middleware'\r\nimport bodyParser from 'body-parser'\r\nimport qs from 'qs'\r\n\r\nimport { APIURL } from './config'\r\n\r\nconst router = express.Router()\r\nconst jsonParser = bodyParser.json()\r\nconst urlencodedParser = bodyParser.urlencoded({ extended: false })\r\n\r\nconst axiosInstance = axios.create({\r\n  headers: {\r\n    'Content-Type': 'application/x-www-form-urlencoded',\r\n    'Device': 'website'\r\n  }\r\n})\r\n\r\n// 登录检查\r\nconst checkLogin = (req, res, next) => {\r\n  return req.session.userData ? next() : res.json({\r\n    error_code: '1',\r\n    info: 'Please login.'\r\n  })\r\n}\r\n\r\n// 用户登录\r\nrouter.post('/login.json', urlencodedParser, (req, res) => {\r\n  let { userName, password } = req.body\r\n  axiosInstance.post(`${APIURL}/student_login.json`, qs.stringify({\r\n    userName, password\r\n  })).then(({ data }) => {\r\n    if (data.error_code === '0') {\r\n      req.session.userData = { userName, password }\r\n    }\r\n    res.json(data)\r\n  }).catch(err => {\r\n    res.json({ error_code: '504', info: err.message })\r\n  })\r\n})\r\n\r\n// 用户退出\r\nrouter.post('/logout.json', urlencodedParser, (req, res) => {\r\n  axiosInstance.post(`${APIURL}/student_logout.json`, qs.stringify({\r\n    token: req.body.token\r\n  })).then(({ data }) => {\r\n    delete req.session.userData\r\n    res.json(data)\r\n  }).catch(err => {\r\n    res.json({ error_code: '504', info: err.message })\r\n  })\r\n})\r\n\r\n// 启用HTTP代理\r\nrouter.use('/**', proxy({\r\n  target: APIURL,\r\n  changeOrigin: true,\r\n  pathRewrite: { '^/api': '' }\r\n}))\r\n\r\nexport default router\n\n\n// WEBPACK FOOTER //\n// ./server/api-router.js","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"http-proxy-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http-proxy-middleware\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"qs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"qs\"\n// module id = 10\n// module chunks = 0","/**\r\n * 后台配置\r\n */\r\n\r\nexport const APIURL = process.env.APIURL || 'http://47.104.27.50:88/circcus/api/student'\n\n\n// WEBPACK FOOTER //\n// ./server/config.js","module.exports = {\r\n  /*\r\n  ** Headers of the page\r\n  */\r\n  head: {\r\n    title: 'nuxt-circcus',\r\n    meta: [\r\n      { charset: 'utf-8' },\r\n      { name: 'viewport', content: 'user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width' },\r\n      { 'http-equiv': 'X-UA-Compatible', content: 'ie=edge' },\r\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\r\n    ],\r\n    link: [\r\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\r\n    ],\r\n    script: [\r\n      { src: 'http://cdn.bootcss.com/strophe.js/1.2.8/strophe.min.js' }\r\n    ]\r\n  },\r\n  /*\r\n  ** Global CSS\r\n  */\r\n css: [\r\n    // { src: 'element-ui/lib/theme-chalk/index.css' },\r\n    { src: '~assets/scss/base.scss', lang: 'scss' }\r\n  ],\r\n  /**\r\n   * Add plugins\r\n   */\r\n  plugins: [\r\n    { src: '~plugins/element-ui', ssr: true },\r\n    { src: '~components/inbox/core', ssr: false }\r\n  ],\r\n  /*\r\n  ** Add axios globally\r\n  */\r\n  build: {\r\n    vendor: ['axios', 'element-ui', 'email-validator', 'moment', 'localforage']\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js"],"sourceRoot":""}